<UserControl x:Class="VDLaser.Views.Controls.ControleView"
             x:Name="ControleRoot"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:VDLaser.ViewModels.Controls;assembly=VDLaser.ViewModels"
             mc:Ignorable="d"
             Background="Transparent">
    <UserControl.Resources>
        <ResourceDictionary>
            <BooleanToVisibilityConverter x:Key="BoolToVis" />
        </ResourceDictionary>
    </UserControl.Resources>
    <GroupBox 
        Style="{StaticResource GroupBoxStyleVD}"
        Background="{Binding Background, ElementName=ControleRoot}">
        <GroupBox.Header>
            <TextBlock Text="Controle" 
                   Visibility="{Binding ShowControls, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVis}}"/>
        </GroupBox.Header>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!--Unlock ($X), Soft reset & pause/resume-->

                <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center"
                            VerticalAlignment="Top">
                    <Button Content="Kill alarm" Margin="0 5 0 0" Width="60" 
                        ToolTip="Unlock $X, used to get your machine going again after pressing reset" FontWeight="Bold" Background="Orange"
                        Command="{Binding KillAlarmCommand, Mode=OneWay}"/>
                    <Button Content="Soft reset" Margin="5 5 0 0" Width="60" 
                        ToolTip="Soft reset, it stop any axis mouvement" FontWeight="Bold" Background="Orange"
                        Command="{Binding SoftResetCommand, Mode=OneWay}"/>
                </StackPanel>
                <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center"
                            VerticalAlignment="Top">
                    <Button Width="60" Margin="0 5 0 0" Content="Pause" 
                            ToolTip="Pause cycle"
                            Command="{Binding FeedHoldCommand, Mode=OneWay}"
                            Style="{StaticResource PauseButtonStyleVD}"/>
                    <Button Width="60" Margin="5 5 0 0" Content="Resume" 
                            ToolTip="Start/Resume cycle after a pause"
                            Command="{Binding StartCycleCommand, Mode=OneWay}"/>    
                </StackPanel>

            <!--Homing button, pre-defined position 1 & 2 and set zero WCS-->

            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" 
                            Visibility="{Binding ShowControls, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVis}}">
                    <Button Width="60" 
                            Margin="0,5,0,0" Content="Home" 
                            ToolTip="Homing the machine, only if limits switch are configured"
                            Command="{Binding HomingCommand, Mode=OneWay}"/>
                    <Button Content="H1" Width="27" 
                            ToolTip="Pre-defined position 1 set by G28.1 in Grbl settings"
                            Margin="5,5,0,0"
                            Command="{Binding Home1Command, Mode=OneWay}"/>
                    <Button Content="H2" Width="27" 
                            ToolTip="Pre-defined position 2 set by G30.1 in Grbl settings"
                            Margin="5,5,0,0"
                            Command="{Binding Home2Command, Mode=OneWay}"/>
                </StackPanel>
            <StackPanel Grid.Row="3" 
            Visibility="{Binding ShowControls, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVis}}">
                <Button Command="{Binding SetWorkZeroCommand}" Margin="0,5,0,0" Width="120" 
                        ToolTip="Set zero (X0 Y0) to the current work position">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="🎯" VerticalAlignment="Center"/>
                        <TextBlock Text="Set Zero (WCS)" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>
    </GroupBox>
</UserControl>
